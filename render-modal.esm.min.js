"use strict";
/** * @name renderModal * @description Classe para gerenciar modais Bootstrap. * @version 1.0.0 * @author Rômulo Costa <rocooliveira@outlook.com> * @license MIT * @repository https://github.com/rocooliveira/renderModal * * Criado para facilitar a criação e controle de modais utilizando Bootstrap 5, * com recursos como carregamento assíncrono, personalização de rodapé e callbacks. * */class renderModal{#e={};constructor(e={}){this.defaults={title:"",backdrop:!0,btnConfirmCancel:!0,customHandle:!0,closeToDone:!0,footerActions:!0,fontWeight:"normal",alignBody:"start",size:"",scrollable:!1,centered:!1,alignEnd:!1,verticalPadding:3,modalClass:"",extraButton:"",...e},this._setupGlobalEventListeners()}_setupGlobalEventListeners(){document.addEventListener("click",(e=>{if(e.target.classList.contains("modal-cancel")||e.target.classList.contains("modal-dismiss")){e.target.blur();const n=e.target.closest(".generic-modal");if(n){const e=bootstrap.Modal.getInstance(n);e&&e.hide()}}}))}element(e=null){return e?this.#e.dialog.querySelector(e):this.#e.dialog}setContent(e){this.#e.dialog.querySelector(".modal-main-content").innerHTML=e}loading(e=!0){const n='<div class="spinner-border spinner-border-sm text-secondary me-auto"></div>',t=this.#e.dialog.querySelector(".modal-confirm"),o=this.#e.dialog.querySelector(".modal-footer");if(!0===e){if(t&&(t.disabled=!0),!o.querySelector(".spinner-border")){const e=document.createElement("div");e.innerHTML=n.trim(),o.prepend(e.firstChild)}}else{t&&(t.disabled=!1);const e=o.querySelector(".spinner-border");e&&e.remove()}}clear(){this.#e.dialog.querySelector(".modal-main-content").innerHTML=""}confirm(e,n=null){const t=this.#e.dialog.querySelector(".modal-confirm");if(t)return t.addEventListener("click",(async()=>{t.blur();if(!1!==n&&"AsyncFunction"===e.constructor.name||!0===n)return this.loading(!0),await e(),void this.loading(!1);e()})),t}cancel(e){const n=this.#e.dialog.querySelector(".modal-cancel");if(n)return"function"==typeof e&&n.addEventListener("click",e),n}onRender(){const e=this.#e.dialog,n=t=>{e.classList.contains("show")?t():setTimeout((function(){n(t)}),300)};return new Promise((function(e){n((function(){e(!0)}))}))}onClose(){const e=this.#e.dialog;return new Promise((function(n){e.addEventListener("hidden.bs.modal",(function t(){e.removeEventListener("hidden.bs.modal",t),n(!0)}))}))}close(){const e=bootstrap.Modal.getInstance(this.#e.dialog);e&&e.hide()}render(e={},n={}){"string"==typeof e&&(e={body:e});const t={...this.defaults,...e};let{id:o,title:l,body:a,backdrop:s,btnConfirmCancel:d,customHeader:i,noHeader:r,customFooter:c,footerActions:m,closeToDone:u,rmConfirmWhenDone:h,customHandle:b,extraButton:g,fontWeight:f,alignBody:y,size:v,scrollable:p,centered:$,alignEnd:S,verticalPadding:E,modalClass:q}=t;const L=o?`id="${o}"`:"",x=`modal-ref-${Date.now()}`;let k=l,C=a||"",w=Array.isArray(d)?d[0]:"Cancelar",M=Array.isArray(d)?d[1]:"Confirmar",A="",T="";switch(v){case"sm":v="modal-sm";break;case"lg":v="modal-lg";break;case"xl":v="modal-xl";break;case"full":case"fullscreen":v="modal-fullscreen";break;default:v=""}let H=p?"modal-dialog-scrollable":"",I=$?"modal-dialog-centered":"";m&&(A=d?`<button class="modal-cancel btn btn-secondary modal-dismiss">${w}</button>\n <button class="modal-confirm btn btn-primary">${M}</button>`:'<button class="modal-ok btn btn-secondary px-4 modal-dismiss"> Ok </button>'),g&&(g=`<div class="col">${g}</div>`),S&&(T="display:flex; align-items:end; min-height: 93%;");const z=r?"":i?`<div class="modal-header">${i}</div>`:`<div class="modal-header" ${""!==l?"":'style="padding:0.70rem 1rem;"'}>\n <h5 class="modal-title">${k}</h5>\n <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n </div>`;if(C.includes("{{loading}}")){const e='<div class="spinner-border spinner-border-sm text-secondary my-auto"></div>';C=C.replace(/{{loading}}/g,e)}const B=`\n <div \n ${L}\n class="generic-modal modal fade ${x} ${q}"\n tabindex="-1"\n role="dialog"\n data-bs-backdrop="${s}"\n >\n <div \n class="modal-dialog ${v} ${H} ${I}" \n role="dialog" \n style="${T}"\n >\n <div class="modal-content">\n ${z}\n <div class="modal-body py-${E}">\n <div \n class="modal-main-content h-100 pt-2 pb-1 text-${y} fw-${f}"\n >\n ${C}\n </div> \n </div>\n ${c?`<div class="modal-footer">${c}</div>`:`<div class="modal-footer ${m?"":"d-none"}">\n ${g}\n ${A}\n </div>`}\n </div>\n </div>\n </div>\n `,D=document.createElement("div");let P,F;D.innerHTML=B.trim(),this.#e.dialog=D.firstChild;const W=new Promise(((e,n)=>{P=e,F=n}));if(m)if(d){const e=this.#e.dialog.querySelector(".modal-cancel");if(e&&e.addEventListener("click",(()=>{F()})),!b){const e=this.#e.dialog.querySelector(".modal-confirm");e&&e.addEventListener("click",(()=>{P(n)}))}}else{const e=this.#e.dialog.querySelector(".modal-ok");e&&e.addEventListener("click",(()=>{P()}))}const _=document.querySelector(".generic-modal:last-child");document.body.appendChild(this.#e.dialog);if(new bootstrap.Modal(this.#e.dialog,{backdrop:s}).show(),_){const e=window.getComputedStyle(_),n=parseInt(e.zIndex)+1,t=n-1;this.#e.dialog.style.zIndex=n,this.#e.dialog.addEventListener("shown.bs.modal",(function(){const e=document.querySelector(".modal-backdrop:last-child");e&&(e.style.zIndex=t)}))}return this.#e.dialog.addEventListener("hide.bs.modal",(function(e){document.activeElement&&document.activeElement.blur()})),this.#e.dialog.addEventListener("hidden.bs.modal",(function(e){this.remove()})),W.then((()=>{const e=document.activeElement;if(e&&this.#e.dialog.contains(e)&&e.blur(),h){const e=this.#e.dialog.querySelector(".modal-confirm"),n=this.#e.dialog.querySelector(".modal-cancel");e&&e.parentElement.remove(),n&&(n.textContent="Fechar",n.parentElement&&(n.parentElement.classList="col-md-12 col-xs-12 d-block"))}u&&setTimeout((()=>{this.close()}),0)})).catch((()=>{const e=document.activeElement;e&&this.#e.dialog.contains(e)&&e.blur(),setTimeout((()=>{this.close()}),0)})),W}error(e="",n='<i class="fas fa-exclamation-triangle"></i> Algo Errado'){e||(e="Não foi possível concluir a solicitação"),e=String(e).replaceAll("\n","<br>");const t="modalError_"+String(Date.now()).toString().substr(8,5);this.render({id:t,title:n,body:e,btnConfirmCancel:!1});const o=document.getElementById(t);if(o){const e=o.querySelector(".modal-content"),n=o.querySelector(".modal-title");e&&(e.style.border="2px solid #801414"),n&&(n.style.color="#801414")}}errorResponse(e="Não foi possível concluir a solicitação",n="",t=""){if(!document.querySelector(".modal-main-content"))return;n&&(n=`${n} <br>`);const o=t?`.generic-modal${t}`:".generic-modal",l=document.querySelector(`${o} .modal-content`),a=document.querySelector(`${o} .modal-header`),s=document.querySelector(`${t||""}.modal-main-content`),d=document.querySelector(`${t||""}.modal-confirm`),i=document.querySelector(`${t||""}.modal-cancel`),r=document.querySelector(`${o} .modal-footer .spinner-border`);l&&(l.style.border="2px solid #801414"),a&&(a.style.color="#801414"),s&&(s.innerHTML=`<div class="py-3"><b class="fts-2">${n}</b>${e}</div>`),d&&(d.disabled=!0,d.style.border="1px solid #4db7fe"),document.body.classList.remove("modal-open"),i&&(i.textContent="Fechar",i.addEventListener("click",(function(){document.querySelectorAll(".generic-modal").forEach((e=>{const n=bootstrap.Modal.getInstance(e);n&&n.hide()}))}))),r&&(r.style.display="none")}}export default renderModal;
