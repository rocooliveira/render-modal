"use strict";class renderModal{#e={};constructor(e={}){this.defaults={title:"",backdrop:!0,btnConfirmCancel:!0,customHandle:!0,closeToDone:!0,footerActions:!0,fontWeight:"normal",alignBody:"start",size:"",scrollable:!1,centered:!1,alignEnd:!1,verticalPadding:3,modalClass:"",extraButton:"",...e},this._setupGlobalEventListeners()}_setupGlobalEventListeners(){document.addEventListener("click",(e=>{if(e.target.classList.contains("modal-cancel")||e.target.classList.contains("modal-dismiss")){e.target.blur();const t=e.target.closest(".generic-modal");if(t){const e=bootstrap.Modal.getInstance(t);e&&e.hide()}}}))}element(e=null){return e?this.#e.dialog.querySelector(e):this.#e.dialog}setContent(e){this.#e.dialog.querySelector(".modal-main-content").innerHTML=e}loading(e=!0){const t='<div class="spinner-border spinner-border-sm text-secondary me-auto"></div>',n=this.#e.dialog.querySelector(".modal-confirm"),o=this.#e.dialog.querySelector(".modal-footer");if(!0===e){if(n&&(n.disabled=!0),!o.querySelector(".spinner-border")){const e=document.createElement("div");e.innerHTML=t.trim(),o.prepend(e.firstChild)}}else{n&&(n.disabled=!1);const e=o.querySelector(".spinner-border");e&&e.remove()}}clear(){this.#e.dialog.querySelector(".modal-main-content").innerHTML=""}confirm(e,t=null){const n=this.#e.dialog.querySelector(".modal-confirm");if(n)return n.addEventListener("click",(async()=>{n.blur();if(!1!==t&&"AsyncFunction"===e.constructor.name||!0===t)return this.loading(!0),await e(),void this.loading(!1);e()})),n}cancel(e){const t=this.#e.dialog.querySelector(".modal-cancel");if(t)return"function"==typeof e&&t.addEventListener("click",e),t}onRender(){const e=this.#e.dialog,t=n=>{e.classList.contains("show")?n():setTimeout((function(){t(n)}),300)};return new Promise((function(e){t((function(){e(!0)}))}))}onClose(){const e=this.#e.dialog;return new Promise((function(t){e.addEventListener("hidden.bs.modal",(function n(){e.removeEventListener("hidden.bs.modal",n),t(!0)}))}))}close(){const e=bootstrap.Modal.getInstance(this.#e.dialog);e&&e.hide()}render(e={},t={}){"string"==typeof e&&(e={body:e});const n={...this.defaults,...e};let{id:o,title:l,body:s,backdrop:a,btnConfirmCancel:d,customHeader:i,noHeader:r,customFooter:c,footerActions:m,closeToDone:u,rmConfirmWhenDone:h,customHandle:b,extraButton:f,fontWeight:g,alignBody:y,size:v,scrollable:p,centered:$,alignEnd:S,verticalPadding:q,modalClass:E}=n;const x=o?`id="${o}"`:"",L=`modal-ref-${Date.now()}`;let k=l,C=s||"",w=Array.isArray(d)?d[0]:"Cancelar",A=Array.isArray(d)?d[1]:"Confirmar",M="",T="";switch(v){case"sm":v="modal-sm";break;case"lg":v="modal-lg";break;case"xl":v="modal-xl";break;case"full":case"fullscreen":v="modal-fullscreen";break;default:v=""}let H=p?"modal-dialog-scrollable":"",I=$?"modal-dialog-centered":"";m&&(M=d?`<button class="modal-cancel btn btn-secondary modal-dismiss">${w}</button>\n <button class="modal-confirm btn btn-primary">${A}</button>`:'<button class="modal-ok btn btn-secondary px-4 modal-dismiss"> Ok </button>'),f&&(f=`<div class="col">${f}</div>`),S&&(T="display:flex; align-items:end; min-height: 93%;");const P=r?"":i?`<div class="modal-header">${i}</div>`:`<div class="modal-header" ${""!==l?"":'style="padding:0.70rem 1rem;"'}>\n <h5 class="modal-title">${k}</h5>\n <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n </div>`;if(C.includes("{{loading}}")){const e='<div class="spinner-border spinner-border-sm text-secondary my-auto"></div>';C=C.replace(/{{loading}}/g,e)}const z=`\n <div \n ${x}\n class="generic-modal modal fade ${L} ${E}"\n tabindex="-1"\n role="dialog"\n data-bs-backdrop="${a}"\n >\n <div \n class="modal-dialog ${v} ${H} ${I}" \n role="dialog" \n style="${T}"\n >\n <div class="modal-content">\n ${P}\n <div class="modal-body py-${q}">\n <div \n class="modal-main-content h-100 pt-2 pb-1 text-${y} fw-${g}"\n >\n ${C}\n </div> \n </div>\n ${c?`<div class="modal-footer">${c}</div>`:`<div class="modal-footer ${m?"":"d-none"}">\n ${f}\n ${M}\n </div>`}\n </div>\n </div>\n </div>\n `,B=document.createElement("div");let D,F;B.innerHTML=z.trim(),this.#e.dialog=B.firstChild;const W=new Promise(((e,t)=>{D=e,F=t}));if(m)if(d){const e=this.#e.dialog.querySelector(".modal-cancel");if(e&&e.addEventListener("click",(()=>{F()})),!b){const e=this.#e.dialog.querySelector(".modal-confirm");e&&e.addEventListener("click",(()=>{D(t)}))}}else{const e=this.#e.dialog.querySelector(".modal-ok");e&&e.addEventListener("click",(()=>{D()}))}const _=document.querySelector(".generic-modal:last-child");document.body.appendChild(this.#e.dialog);if(new bootstrap.Modal(this.#e.dialog,{backdrop:a}).show(),_){const e=window.getComputedStyle(_),t=parseInt(e.zIndex)+1,n=t-1;this.#e.dialog.style.zIndex=t,this.#e.dialog.addEventListener("shown.bs.modal",(function(){const e=document.querySelector(".modal-backdrop:last-child");e&&(e.style.zIndex=n)}))}return this.#e.dialog.addEventListener("hide.bs.modal",(function(e){document.body.focus(),setTimeout((()=>{const e=document.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');for(const t of e)if(null!==t.offsetParent&&!t.closest(".modal")){t.focus();break}}),0)})),this.#e.dialog.addEventListener("hidden.bs.modal",(function(e){this.remove()})),W.then((()=>{const e=document.activeElement;if(e&&this.#e.dialog.contains(e)&&e.blur(),h){const e=this.#e.dialog.querySelector(".modal-confirm"),t=this.#e.dialog.querySelector(".modal-cancel");e&&e.parentElement.remove(),t&&(t.textContent="Fechar",t.parentElement&&(t.parentElement.classList="col-md-12 col-xs-12 d-block"))}u&&setTimeout((()=>{this.close()}),0)})).catch((()=>{const e=document.activeElement;e&&this.#e.dialog.contains(e)&&e.blur(),setTimeout((()=>{this.close()}),0)})),W}error(e="",t='<i class="fas fa-exclamation-triangle"></i> Algo Errado'){e||(e="Não foi possível concluir a solicitação"),e=String(e).replaceAll("\n","<br>");const n="modalError_"+String(Date.now()).toString().substr(8,5);this.render({id:n,title:t,body:e,btnConfirmCancel:!1});const o=document.getElementById(n);if(o){const e=o.querySelector(".modal-content"),t=o.querySelector(".modal-title");e&&(e.style.border="2px solid #801414"),t&&(t.style.color="#801414")}}errorResponse(e="Não foi possível concluir a solicitação",t="",n=""){if(!document.querySelector(".modal-main-content"))return;t&&(t=`${t} <br>`);const o=n?`.generic-modal${n}`:".generic-modal",l=document.querySelector(`${o} .modal-content`),s=document.querySelector(`${o} .modal-header`),a=document.querySelector(`${n||""}.modal-main-content`),d=document.querySelector(`${n||""}.modal-confirm`),i=document.querySelector(`${n||""}.modal-cancel`),r=document.querySelector(`${o} .modal-footer .spinner-border`);l&&(l.style.border="2px solid #801414"),s&&(s.style.color="#801414"),a&&(a.innerHTML=`<div class="py-3"><b class="fts-2">${t}</b>${e}</div>`),d&&(d.disabled=!0,d.style.border="1px solid #4db7fe"),document.body.classList.remove("modal-open"),i&&(i.textContent="Fechar",i.addEventListener("click",(function(){document.querySelectorAll(".generic-modal").forEach((e=>{const t=bootstrap.Modal.getInstance(e);t&&t.hide()}))}))),r&&(r.style.display="none")}}export default renderModal;
